module.exports=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){const a=r(1),n=r(2),s=r(4),i=(e,t)=>(s.info("Starting Authorization Extension - Version:","2.9.0"),s.info(" > WT_URL:",e("WT_URL")),s.info(" > PUBLIC_WT_URL:",e("PUBLIC_WT_URL")),r(6)(e,t));let o=(e,t,r)=>{setImmediate(()=>{t.x_wt&&t.x_wt.ectx&&t.x_wt.ectx.PUBLIC_WT_URL||!1||n.setValue("PUBLIC_WT_URL",a.urlHelpers.getWebtaskUrl(t)),(o=a.createServer(i))(e,t,r)})};e.exports=((e,t,r)=>{o(e,t,r)})},function(e,t){e.exports=require("auth0-extension-hapi-tools")},function(e,t,r){"use strict";r.r(t);var a=r(3);t.default=Object(a.config)()},function(e,t){e.exports=require("auth0-extension-tools")},function(e,t,r){const a=r(5);a.emitErrs=!0;const n=new a.Logger({transports:[new a.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=n},function(e,t){e.exports=require("winston")},function(e,t,r){"use strict";r.r(t),function(e){var t=r(2),a=r(8),n=r(11),s=r(12),i=r(15),o=r(4),u=r.n(o);e.exports=((e,r,o)=>(null==o&&(o=(e=>{e?(u.a.error("Hapi initialization failed."),u.a.error(e)):u.a.info("Hapi initialization completed.")})),t.default.setProvider(t=>e(t)||Object({WARN_DB_SIZE:409600,MAX_MULTISELECT_USERS:5,MULTISELECT_DEBOUNCE_MS:250,PER_PAGE:10,NODE_ENV:"production",CLIENT_VERSION:"2.9.0"})[t]),Object(n.init)(new a.default({provider:Object(s.createProvider)(r)})),Object(i.default)(o)))}.call(this,r(7)(e))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return p});var a=r(9),n=r.n(a),s=r(10),i=r.n(s),o=r(3),u=r(2);const c=(e=[],t="Record with that identifier is already exists.",r)=>0===e.length?null:r&&1===e.length&&e[0]._id===r?null:i.a.reject(new o.ValidationError(t));class p{constructor(e={}){if(!e.provider)throw new o.ArgumentError("The 'provider' has to be set when initializing the database.");this.provider=e.provider}getStatus(){return Object(u.default)("STORAGE_TYPE")&&"webtask"!==Object(u.default)("STORAGE_TYPE")?i.a.resolve({size:null,type:Object(u.default)("STORAGE_TYPE")}):this.provider.storageContext.read().then(e=>({size:Buffer.byteLength(JSON.stringify(e),"utf8"),type:"default"}))}canChange(e,t,r){return this.provider.getAll(e).then(e=>n.a.filter(e,e=>e[t]&&n.a.includes(e[t],r))).then(r=>{if(r.length){const a=r.map(e=>e.name).join(", "),n=`Unable to touch ${t} while used in ${e}: ${a}`;return i.a.reject(new o.ValidationError(n))}return i.a.resolve()})}getApiKey(){return this.provider.getAll("configuration").then(e=>e.length?e[0].apikey:null)}updateApiKey(e){return this.provider.getAll("configuration").then(e=>e.length?e[0]:{}).then(t=>this.provider.update("configuration","v1",{...t,apikey:e},!0))}getConfiguration(){return this.provider.getAll("configuration").then(e=>e.length?e[0]:null)}updateConfiguration(e){return this.provider.update("configuration","v1",e,!0)}getRules(){return this.provider.getAll("rules")}createRule(e){return this.provider.create("rules",e)}getPermissions(){return this.provider.getAll("permissions")}getPermission(e){return this.provider.get("permissions",e)}createPermission(e){return this.getPermissions().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()&&t.applicationId===e.applicationId),`Permission with name "${e.name}" already exists for this application`)).then(()=>this.provider.create("permissions",e))}updatePermission(e,t){return this.getPermissions().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.applicationId===t.applicationId),`Permission with name "${t.name}" already exists for this application`,e)).then(()=>this.canChange("roles","permissions",e)).then(()=>this.canChange("groups","permissions",e)).then(()=>this.provider.update("permissions",e,t))}deletePermission(e){return this.canChange("roles","permissions",e).then(()=>this.provider.delete("permissions",e))}getRoles(){return this.provider.getAll("roles")}getRole(e){return this.provider.get("roles",e)}createRole(e){return this.getRoles().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()&&t.applicationId===e.applicationId),`Role with name "${e.name}" already exists for this application`)).then(()=>this.provider.create("roles",e))}updateRole(e,t){return this.getRoles().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.applicationId===t.applicationId),`Role with name "${t.name}" already exists for this application`,e)).then(()=>this.provider.update("roles",e,t))}deleteRole(e){return this.canChange("groups","roles",e).then(()=>this.provider.delete("roles",e))}getGroups(){return this.provider.getAll("groups")}getGroup(e){return this.provider.get("groups",e)}createGroup(e){return this.getGroups().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()),`Group with name "${e.name}" already exists`)).then(()=>this.provider.create("groups",e))}updateGroup(e,t){return this.getGroups().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()),`Group with name "${t.name}" already exists`,e)).then(()=>this.provider.update("groups",e,t))}deleteGroup(e){return this.canChange("groups","nested",e).then(()=>this.provider.delete("groups",e))}getApplications(){return this.provider.getAll("applications")}getApplication(e){return this.provider.get("applications",e)}updateApplication(e,t){return this.provider.update("applications",e,t,!0)}}},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("bluebird")},function(e,t){let r=null;e.exports.init=(e=>{r=e}),e.exports.getDb=(()=>{if(!r)throw new Error("The database has not been initialized.");return r})},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"createProvider",function(){return p});var a=r(13),n=r.n(a),s=r(14),i=r(3),o=r(2),u=r(4),c=r.n(u);function p(t){switch(Object(o.default)("STORAGE_TYPE")){case"s3":{c.a.info("Initializing the S3 Storage Context.");const e=new s.S3StorageContext({path:Object(o.default)("S3_PATH"),bucket:Object(o.default)("S3_BUCKET"),keyId:Object(o.default)("S3_KEY"),keySecret:Object(o.default)("S3_SECRET"),defaultData:{}});return new i.BlobRecordProvider(e,{concurrentWrites:!1})}case"webtask":default:{c.a.info("Initializing the Webtask Storage Context.");const r=t?new i.WebtaskStorageContext(t,{force:0}):new i.FileStorageContext(n.a.join(e,"../../data.json"),{mergeWrites:!0});return new i.BlobRecordProvider(r,{concurrentWrites:!1})}}}}.call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("auth0-extension-s3-tools")},function(e,t,r){"use strict";r.r(t);var a=r(16),n=r.n(a),s=r(17),i=r.n(s),o=r(18),u=r.n(o),c=r(19),p=r.n(c),d=r(20),l=r.n(d),h=r(21),g=r.n(h),f=r(22),m=r.n(f),v=r(23),y=r.n(v),x=r(2),b=r(4),w=r.n(b),_=r(24),E=r.n(_);t.default=(e=>{const t={register:i.a,options:{ops:{interval:3e4},reporters:{console:[]}}},r={register:y.a,options:{documentationPage:!1,swaggerUI:!1}};t.options.reporters.console.push(new m.a({color:!!Object(x.default)("LOG_COLOR")})),t.options.reporters.console.push("stdout");const a=p()({}),s=new n.a.Server;return s.connection({host:"localhost",port:3e3,routes:{cors:!0,validate:{failAction:a.failAction}}}),s.register([t,u.a,l.a,g.a,r,...E.a],t=>t?e(t,null):(w.a.debug=((...e)=>{s.log(["debug"],e.join(" "))}),w.a.info=((...e)=>{s.log(["info"],e.join(" "))}),w.a.error=((...e)=>{s.log(["error"],e.join(" "))}),e(null,s))),s.ext("onPreResponse",(e,t)=>(e.response&&e.response.isBoom&&e.response.output&&(s.log(["error"],`Request: ${e.method.toUpperCase()} ${e.url.path}`),s.log(["error"],`Response: ${JSON.stringify(e.response,null,2)}`)),t.continue())),s})},function(e,t){e.exports=require("@auth0/hapi")},function(e,t){e.exports=require("good")},function(e,t){e.exports=require("inert")},function(e,t){e.exports=require("relish")},function(e,t){e.exports=require("blipp")},function(e,t){e.exports=require("hapi-auth-jwt2")},function(e,t){e.exports=require("good-console")},function(e,t){e.exports=require("hapi-swagger")},function(e,t,r){e.exports=[{register:r(25)},{register:r(32)},{register:r(33)},{register:r(34)},{register:r(38)},{register:r(118)},{register:r(119)}]},function(e,t,r){"use strict";r.r(t),function(e){var t=r(26),a=r.n(t),n=r(27),s=r.n(n),i=r(28),o=r.n(i),u=r(29),c=r.n(u),p=r(1),d=r(2),l=r(30);e.exports.register=((e,t,r)=>{e.auth.scheme("extension-secret",()=>({authenticate:(e,t)=>{const r=e.headers["x-api-key"];return e.storage.getApiKey().then(e=>r&&r===(e=>s.a.createHmac("sha256",`${e} + ${Object(d.default)("AUTH0_CLIENT_SECRET")}`).update(Object(d.default)("EXTENSION_SECRET")).digest("hex"))(e)?t.continue({credentials:{user:"rule"}}):t(a.a.unauthorized("Invalid API Key")))}})),e.auth.strategy("extension-secret","extension-secret");const n={dashboardAdmin:{key:Object(d.default)("EXTENSION_SECRET"),verifyOptions:{audience:"urn:api-authz",issuer:Object(d.default)("PUBLIC_WT_URL"),algorithms:["HS256"]}},resourceServer:{key:o.a.hapiJwt2Key({cache:!0,rateLimit:!0,jwksRequestsPerMinute:2,jwksUri:`https://${Object(d.default)("AUTH0_DOMAIN")}/.well-known/jwks.json`}),verifyOptions:{audience:"urn:auth0-authz-api",issuer:`https://${Object(d.default)("AUTH0_DOMAIN")}/`,algorithms:["RS256"]}}};e.auth.strategy("jwt","jwt",{complete:!0,verifyFunc:(e,t,r)=>{if(!e)return r(null,!1);const s=t.headers.authorization;if(s&&0===s.indexOf("Bearer ")){const t=s.split(" ")[1];if(e&&e.payload&&e.payload.iss===`https://${Object(d.default)("AUTH0_DOMAIN")}/`)return n.resourceServer.key(e,(s,i)=>s?r(a.a.wrap(s),null,null):c.a.verify(t,i,n.resourceServer.verifyOptions,t=>t?r(a.a.unauthorized("Invalid token","Token"),null,null):e.payload.gty&&"client-credentials"!==e.payload.gty?r(a.a.unauthorized("Invalid token","Token"),null,null):e.payload.sub.endsWith("@clients")?(e.payload.scope&&"string"==typeof e.payload.scope&&(e.payload.scope=e.payload.scope.split(" ")),r(null,!0,e.payload)):r(a.a.unauthorized("Invalid token","Token"),null,null)));if(e&&e.payload&&e.payload.iss===Object(d.default)("PUBLIC_WT_URL"))return c.a.verify(t,n.dashboardAdmin.key,n.dashboardAdmin.verifyOptions,t=>t?r(a.a.unauthorized("Invalid token","Token"),null,null):e.payload.access_token&&e.payload.access_token.length?(e.payload.scope=l.scopes.map(e=>e.value),r(null,!0,e.payload)):r(a.a.unauthorized("Invalid token","Token"),null,null))}return r(null,!1)}}),e.auth.default("jwt");const i={register:p.plugins.dashboardAdminSession,options:{stateKey:"authz-state",nonceKey:"authz-nonce",sessionStorageKey:"authz:apiToken",rta:Object(d.default)("AUTH0_RTA").replace("https://",""),domain:Object(d.default)("AUTH0_DOMAIN"),scopes:"read:resource_servers create:resource_servers update:resource_servers delete:resource_servers read:clients read:connections read:rules create:rules update:rules update:rules_configs read:users",baseUrl:Object(d.default)("PUBLIC_WT_URL"),audience:"urn:api-authz",secret:Object(d.default)("EXTENSION_SECRET"),clientName:"Authorization Extension",onLoginSuccess:(e,t,r)=>e?(e.scope=l.scopes.map(e=>e.value),r(null,!0,e)):r(null,!1)}};e.register(i,e=>{e&&r(e),r()})}),e.exports.register.attributes={name:"auth"}}.call(this,r(7)(e))},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("jwks-rsa")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";r.r(t),r.d(t,"getApi",function(){return l}),r.d(t,"createApi",function(){return h}),r.d(t,"updateApi",function(){return g}),r.d(t,"deleteApi",function(){return f}),r.d(t,"scopes",function(){return m});var a=r(10),n=r.n(a),s=r(31),i=r.n(s),o=r(3),u=r(2);const c=[{value:"read:users"},{value:"read:applications"},{value:"read:connections"},{value:"read:configuration"},{value:"update:configuration"},{value:"read:groups"},{value:"create:groups"},{value:"update:groups"},{value:"delete:groups"},{value:"read:roles"},{value:"create:roles"},{value:"update:roles"},{value:"delete:roles"},{value:"read:permissions"},{value:"create:permissions"},{value:"update:permissions"},{value:"delete:permissions"},{value:"read:resource-server"},{value:"create:resource-server"},{value:"update:resource-server"},{value:"delete:resource-server"}],p=(e,t,r,a)=>new n.a((s,c)=>(e=e,e.auth&&e.auth.credentials&&e.auth.credentials.access_token&&e.auth.credentials.access_token.length?n.a.resolve(e.auth.credentials.access_token):o.managementApi.getAccessTokenCached(Object(u.default)("AUTH0_DOMAIN"),Object(u.default)("AUTH0_CLIENT_ID"),Object(u.default)("AUTH0_CLIENT_SECRET"))).then(e=>{i()(r,`https://${Object(u.default)("AUTH0_DOMAIN")}/api/v2/${t}`).send(a||{}).set("Content-Type","application/json").set("Authorization",`Bearer ${e}`).end((e,t)=>e?c(e):s(t.body))}));var d;const l=e=>p(e,"resource-servers","GET").then(e=>{return e.filter(e=>"urn:auth0-authz-api"===e.identifier)[0]||{}}),h=(e,t)=>{return p(e,"resource-servers","POST",{name:"auth0-authorization-extension-api",identifier:"urn:auth0-authz-api",signing_alg:"RS256",scopes:c,token_lifetime:t})},g=(e,t)=>l(e).then(r=>{return r.id?p(e,`resource-servers/${r.id}`,"PATCH",{token_lifetime:t||86400}):h(e,t||86400)}),f=(e,t)=>l(e).then(r=>r.id?p(e,`resource-servers/${r.id}`,"DELETE"):r.id||t?n.a.resolve():n.a.reject(new Error("Unable to disable resource-server. Is it enabled?"))),m=c},function(e,t){e.exports=require("superagent")},function(e,t,r){"use strict";r.r(t),function(e,t){var a=r(13),n=r.n(a);t.exports.register=((t,r,a)=>{t.route({method:"GET",path:"/app/{param*}",config:{auth:!1},handler:{directory:{path:n.a.join(e,"../../dist"),redirectToSlash:!0}}}),a()}),t.exports.register.attributes={name:"assets"}}.call(this,"/",r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(1),a=r(2),n=r(4),s=r.n(n);const i=r(3),o=r(26);e.exports.register=((e,r,n)=>{e.decorate("server","handlers",{managementClient:t.handlers.managementApiClient({domain:Object(a.default)("AUTH0_DOMAIN"),clientId:Object(a.default)("AUTH0_CLIENT_ID"),clientSecret:Object(a.default)("AUTH0_CLIENT_SECRET"),logger:s.a.error}),validateHookToken:((e,t,r)=>{if(null===e||void 0===e)throw new i.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new i.ArgumentError(`The provided domain is invalid: ${e}`);if(null===t||void 0===t)throw new i.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new i.ArgumentError(`The provided webtaskUrl is invalid: ${t}`);if(null===r||void 0===r)throw new i.ArgumentError("Must provide the extensionSecret");if("string"!=typeof r||0===r.length)throw new i.ArgumentError(`The provided extensionSecret is invalid: ${r}`);return a=>{if(null===a||void 0===a)throw new i.ArgumentError("Must provide the hookPath");if("string"!=typeof a||0===a.length)throw new i.ArgumentError(`The provided hookPath is invalid: ${a}`);return{method(n,u){if(n.headers.authorization&&"Bearer"===n.headers.authorization.split(" ")[0]){const c=n.headers.authorization.split(" ")[1];try{if(s.a.info(`Validating hook token with signature: ${r.substr(0,4)}...`),i.validateHookToken(e,t,a,r,c))return u()}catch(e){return s.a.error("Invalid token:",c),u(o.wrap(e,401,e.message))}}const c=new i.HookTokenError(`Hook token missing for the call to: ${a}`);return u(o.unauthorized(c,401,c.message))}}}})(Object(a.default)("AUTH0_DOMAIN"),Object(a.default)("WT_URL"),Object(a.default)("EXTENSION_SECRET"))}),n()}),e.exports.register.attributes={name:"handlers"}}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e,t){var a=r(35),n=r.n(a),s=r(36),i=r.n(s),o=r(13),u=r.n(o),c=r(1),p=r(2),d=r(37),l=r.n(d);const h=["/","/api","/configuration","/configuration/rule","/configuration/api","/roles","/roles/{id}","/groups","/groups/{id}","/permissions","/permissions/{id}","/users","/users/{id}","/import-export"];t.exports.register=((t,r,a)=>{h.map(r=>t.route((t=>({method:"GET",path:t,config:{description:"Render HTML",auth:!1},handler:(t,r)=>{const a={AUTH0_DOMAIN:Object(p.default)("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:Object(p.default)("AUTH0_CLIENT_ID"),BASE_URL:c.urlHelpers.getBaseUrl(t),API_BASE:c.urlHelpers.getBaseUrl(t),BASE_PATH:c.urlHelpers.getBasePath(t),SEARCH_ENGINE:"auth0.auth0.com"!==Object(p.default)("AUTH0_RTA").replace("https://","")?"v2":"v3"},s=Object(p.default)("CLIENT_VERSION");return s?r(i.a.render(l.a,{config:a,assets:{version:s}})):n.a.readFile(u.a.join(e,"../../dist/manifest.json"),"utf8",(e,t)=>{const n={config:a,assets:{app:"/app/bundle.js"}};!e&&t&&(n.assets=JSON.parse(t),n.assets.app&&(n.assets.app=`/app/${n.assets.app}`),n.assets.vendors&&(n.assets.vendors=`/app/${n.assets.vendors}`),n.assets.style&&(n.assets.style=`/app/${n.assets.style}`)),r(i.a.render(l.a,n))})}}))(r))),a()}),t.exports.register.attributes={name:"html"}}.call(this,"/",r(7)(e))},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <title>Auth0 - Authorization</title>\n  <meta charset="UTF-8" />\n  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.8.10/lib/logos/img/favicon.png">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css">\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.8.10/index.min.css" />\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css">\n  <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="<%= assets.style %>"><% } %>\n  <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.<%= assets.version %>.css"><% } %>\n</head>\n<body>\n  <div id="app"></div>\n  <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n  <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n  <% if (assets.vendors) { %><script type="text/javascript" src="<%= assets.vendors %>"><\/script><% } %>\n  <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"><\/script><% } %>\n  <% if (assets.version) { %>\n  <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.vendors.<%= assets.version %>.js"><\/script>\n  <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.<%= assets.version %>.js"><\/script>\n  <% } %>\n</body>\n</html>'},function(e,t,r){"use strict";r.r(t),function(e){var t=r(2);e.exports.register=((e,a,n)=>{e.route(r(39)(e)),e.route(r(47)(e)),e.route(r(48)(e)),e.route(r(49)(e)),e.route(r(50)(e)),e.route(r(51)(e)),e.route(r(52)(e)),e.route(r(55)(e)),e.route(r(59)(e)),e.route(r(60)(e)),e.route(r(61)(e)),e.route(r(62)(e)),e.route(r(63)(e)),e.route(r(64)(e)),e.route(r(65)(e)),e.route(r(66)(e)),e.route(r(67)(e)),e.route(r(68)(e)),e.route(r(69)(e)),e.route(r(70)(e)),e.route(r(72)(e)),e.route(r(73)(e)),e.route(r(74)(e)),e.route(r(75)(e)),e.route(r(76)(e)),e.route(r(78)(e)),e.route(r(79)(e)),e.route(r(80)(e)),e.route(r(81)(e)),e.route(r(82)(e)),e.route(r(84)(e)),e.route(r(85)(e)),e.route(r(86)(e)),e.route(r(87)(e)),e.route(r(88)(e)),e.route(r(89)(e)),e.route(r(91)(e)),e.route(r(92)(e)),e.route(r(93)(e)),e.route(r(94)(e)),e.route(r(96)(e)),e.route(r(100)(e)),e.route(r(102)(e)),e.route(r(105)(e)),e.route(r(106)(e)),e.route(r(107)(e)),e.route(r(109)(e)),e.route(r(110)(e)),e.route(r(111)(e)),e.route(r(112)(e)),e.route(r(113)(e)),e.route(r(114)(e)),e.route(r(115)(e)),e.route(r(116)(e)),e.route(r(117)(e)),e.route({method:"GET",path:"/admins/login",config:{auth:!1},handler:(e,r)=>r("Redirecting to login page...").redirect(`${Object(t.default)("PUBLIC_WT_URL")}/login`)}),n()}),e.exports.register.attributes={name:"routes"}}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(41),s=r(42);e.exports=(()=>({method:"POST",path:"/api/users/{userId}/policy/{clientId}",config:{auth:{strategies:["jwt","extension-secret"]},description:"Execute the authorization policy for a user in the context of a client. This will return the user's groups but also roles and permissions that apply to the current client.",tags:["api"],validate:{params:{userId:a.a.string().required(),clientId:a.a.string().required()},payload:n.default}},handler:(e,t)=>{const{userId:r,clientId:a}=e.params,{connectionName:n,groups:i}=e.payload;return e.storage.provider&&e.storage.provider.storageContext&&e.storage.provider.storageContext.read?Object(s.getUserData)(e.storage,r,a,n,i).then(e=>t(e)).catch(e=>t.error(e)):t.error(new Error("Storage error."))}}))}.call(this,r(7)(e))},function(e,t){e.exports=require("joi")},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({connectionName:n.a.string().required(),groups:n.a.array().items(n.a.string())})},function(e,t,r){"use strict";r.r(t),r.d(t,"getConnectionsCached",function(){return g}),r.d(t,"getPermissionsCached",function(){return f}),r.d(t,"getRolesCached",function(){return m}),r.d(t,"getGroupsCached",function(){return v}),r.d(t,"getMappingsWithNames",function(){return y}),r.d(t,"getChildGroups",function(){return x}),r.d(t,"getParentGroups",function(){return b}),r.d(t,"getRolesForGroups",function(){return w}),r.d(t,"getRolesForUser",function(){return _}),r.d(t,"getPermissionsForRoles",function(){return E}),r.d(t,"getPermissionsByRoles",function(){return T}),r.d(t,"getMembers",function(){return j}),r.d(t,"getDynamicUserGroups",function(){return O}),r.d(t,"getUserGroups",function(){return C}),r.d(t,"getGroupExpanded",function(){return q}),r.d(t,"getGroupsExpanded",function(){return k}),r.d(t,"getUserData",function(){return I});var a=r(9),n=r.n(a),s=r(43),i=r.n(s),o=r(10),u=r.n(o),c=r(44),p=r.n(c),d=r(45);const l=e=>(...t)=>new u.a((r,a)=>{setImmediate(()=>{try{r(e(...t))}catch(e){a(e)}})}),h=e=>({_id:e._id,name:e.name,description:e.description}),g=p()({load:(e,t)=>{Object(d.default)(e,"connections",{fields:"id,name,strategy"}).then(e=>n.a.chain(e).sortBy(e=>e.name.toLowerCase()).value()).then(e=>t(null,e)).catch(e=>t(e))},hash:e=>e.hash||"connections",max:100,maxAge:i.a.get("DATA_CACHE_MAX_AGE")}),f=p()({load:(e,t)=>{e.getPermissions().then(e=>{t(null,e)}).catch(e=>t(e))},hash:e=>e.hash||"permissions",max:100,maxAge:i.a.get("DATA_CACHE_MAX_AGE")}),m=p()({load:(e,t)=>{e.getRoles().then(e=>{t(null,e)}).catch(e=>t(e))},hash:e=>e.hash||"roles",max:100,maxAge:i.a.get("DATA_CACHE_MAX_AGE")}),v=p()({load:(e,t)=>{e.getGroups().then(e=>{t(null,e)}).catch(e=>t(e))},hash:e=>e.hash||"groups",max:100,maxAge:i.a.get("DATA_CACHE_MAX_AGE")}),y=(e,t)=>new u.a((r,a)=>{g(e,(e,s)=>{if(e)return a(e);const i=[];return t.forEach(e=>{const t=n.a.find(s,{name:e.connectionName});if(t){const r=e;r.connectionName=`${t.name} (${t.strategy})`,i.push(r)}}),r(i)})}),x=(e,t)=>{const r=[],a=t=>{if(-1===r.indexOf(t)){r.push(t);const s=n.a.find(e,{_id:t});s&&s.nested&&n.a.forEach(s.nested,e=>{a(e)})}};return t.forEach(e=>a(e._id)),n.a.filter(e,e=>r.indexOf(e._id)>-1)},b=(e,t)=>{const r=[],a=t=>{if(-1===r.indexOf(t)){r.push(t),n.a.filter(e,e=>n.a.includes(e.nested||[],t)).forEach(e=>a(e._id))}};return t.forEach(e=>a(e._id)),n.a.filter(e,e=>r.indexOf(e._id)>-1)},w=(e,t)=>{const r=[],a={};return e.forEach(e=>{e.roles&&e.roles.forEach(t=>{a[t]||(a[t]=e)})}),t.forEach(e=>{a[e._id]&&r.push({role:e,group:a[e._id]})}),r},_=(e,t)=>e.getGroups().then(e=>{const r=n.a.filter(e,e=>n.a.includes(e.members,t));return b(e,r).filter(e=>e.roles&&e.roles.length).map(e=>e.roles)}).then(e=>n.a.uniq(n.a.flattenDeep(e))).then(r=>e.getRoles().then(e=>{const a=n.a.filter(e,e=>n.a.includes(r,e._id)),s=n.a.filter(e,e=>e.users&&n.a.includes(e.users,t));return n.a.uniq([...a,...s],"_id")})),E=(e,t)=>e.getPermissions().then(e=>{const r=n.a.flattenDeep(n.a.map(t,e=>e.permissions));return e.filter(e=>n.a.includes(r,e._id))}),T=(e,t)=>new u.a((r,a)=>{f(e,(e,s)=>{if(e)return a(e);const i=[];return n.a.forEach(t,e=>{const t=s.filter(t=>n.a.includes(e.permissions,t._id));i.push({...e,permissions:n.a.map(t,e=>({_id:e._id,name:e.name,description:e.description}))})}),r(i)})}),j=e=>{const t={};return e.forEach(e=>{e.members&&e.members.forEach(r=>{t[r]||(t[r]=e)})}),Object.keys(t).map(e=>({userId:e,group:t[e]}))},A=(e,t,r)=>e&&n.a.filter(e,e=>((e,t,r)=>e.connectionName===t&&r.indexOf(e.groupName)>-1)(e,t,r)).length>0;function O(e,t,r,a){return new u.a((s,i)=>{if(!t)return s([]);if(!r||0===r.length)return s([]);return(t=>a&&a.length?t(null,a):v(e,t))((e,a)=>{if(e)return i(e);const o=n.a.filter(a,e=>A(e.mappings,t,r));return s(o)})})}function C(e,t,r,a){return Array.isArray(a)&&void 0!==a&&null!==a||(a=[]),new u.a((s,i)=>{v(e,(o,u)=>{if(o)return i(o);const c=n.a.filter(u,e=>n.a.includes(e.members,t));return O(e,r,[...a,...c.map(e=>e.name)],u).then(e=>{const t=b(u,n.a.union(c,e));return s(t)}).catch(i)})})}function q(e,t){return new u.a((r,a)=>{v(e,(s,i)=>s?a(s):m(e,(s,o)=>{if(s)return a(s);const u=n.a.find(i,{_id:t}),c=b(i,[u]).filter(e=>e._id!==u._id),p=w([u,...c],o).map(e=>e.role),d=e=>({_id:e._id,name:e.name,description:e.description,applicationId:e.applicationId,applicationType:e.applicationType,permissions:e.permissions&&e.permissions.map(h)});return T(e,p).then(e=>r({_id:u._id,name:u.name,description:u.description,roles:e.map(d)}))}))})}function k(e,t){return new u.a((r,a)=>{v(e,(n,s)=>n?a(n):m(e,(n,i)=>{if(n)return a(n);const o=b(s,t),u=w(o,i).map(e=>e.role),c=e=>({_id:e._id,name:e.name,description:e.description,applicationId:e.applicationId,applicationType:e.applicationType,permissions:e.permissions&&e.permissions.map(h)});return T(e,u).then(e=>r({groups:o.map(h),roles:e.map(c)}))}))})}function I(e,t,r,a,s){const i={groups:[],roles:[]};return e.provider.storageContext.read().then(o=>{const{groups:u=[],roles:c=[],permissions:p=[]}=o,d=n.a.filter(u,e=>n.a.includes(e.members,t));return Array.isArray(s)||(s=[]),l(O)(e,a,[...s,...d.map(e=>e.name)],u).then(l(e=>{const t=b(u,n.a.union(d,e));return i.groups=n.a.uniq(t.map(e=>e.name)),t})).then(l(e=>{const a=w(e,c).map(e=>e.role),s=c.filter(e=>e.users&&e.users.indexOf(t)>-1),o=[...a,...s].filter(e=>e.applicationId===r);return i.roles=n.a.uniq(o.map(e=>e.name)),o})).then(l(e=>{const t=n.a.flattenDeep(n.a.map(e,e=>e.permissions)),r=p.filter(e=>n.a.includes(t,e._id));return i.permissions=n.a.uniq(r.map(e=>e.name)),i}))})}},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("lru-memoizer")},function(e,t,r){"use strict";r.r(t);var a=r(10),n=r.n(a),s=r(3),i=r(46);t.default=function(e,t,r={},a=100,o=3){if(null===e||void 0===e)throw new s.ArgumentError("Must provide a auth0 client object.");if(!t&&!e[t])throw new s.ArgumentError("Must provide a valid entity for auth0 client.");const u=e[t].getAll,c=Object.assign({},r,{per_page:a}),p=[];let d=0,l=0;const h=t=>Object(i.default)(e,u,[Object.assign({},c,{page:t})]).then(e=>(e.forEach(e=>p.push(e)),null));return(()=>(()=>Object(i.default)(e,u,[Object.assign({},c,{include_totals:!0,page:0})]).then(e=>(d=e.total||0,l=Math.ceil(d/a),(e[t]||e||[]).forEach(e=>p.push(e)),null)))().then(()=>{if(0===d||p.length>=d)return p;const e=[];for(let t=1;t<=l;t++)e.push(t);return n.a.map(e,h,{concurrency:o})}))().then(()=>p)}},function(e,t,r){"use strict";r.r(t);var a=r(10),n=r.n(a);t.default=((e,t,r,a=2)=>{let s=a;const i=()=>t.apply(e,r).then(e=>n.a.resolve(e)).catch(e=>{const t=e.originalError||{},r=t.response&&t.response.header&&t.response.header["x-ratelimit-reset"]||0,a=Math.round((new Date).getTime()/1e3);let o=parseInt(r,10)-a;return 429===t.status&&s>0&&r&&o<=10?(s--,o<=0&&(o=1),(e=>new n.a(t=>setTimeout(()=>t(),1e3*e)))(o).then(i)):n.a.reject(e)});return i()})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(e=>({method:"GET",path:"/api/applications/{clientId}",config:{auth:{strategies:["jwt"],scope:["read:applications"]},description:"Get a single application based on its Client ID.",validate:{params:{clientId:a.a.string().required()}},pre:[e.handlers.managementClient]},handler:(e,t)=>e.pre.auth0.clients.get({client_id:e.params.clientId}).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(45);e.exports=(e=>({method:"GET",path:"/api/applications",config:{auth:{strategies:["jwt"],scope:["read:applications"]},pre:[e.handlers.managementClient]},handler:(e,t)=>Object(n.default)(e.pre.auth0,"clients",{is_global:!1,fields:"client_id,name,callbacks,app_type"}).then(e=>a.a.chain(e).filter(e=>"spa"===e.app_type||"native"===e.app_type||"regular_web"===e.app_type).sortBy(e=>e.name.toLowerCase()).value()).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(45);e.exports=(e=>({method:"GET",path:"/api/configuration/status",config:{auth:{strategies:["jwt"],scope:["read:configuration"]},pre:[e.handlers.managementClient]},handler:(e,t)=>Object(n.default)(e.pre.auth0,"rules",{fields:"name,enabled"}).then(e=>{const t=a.a.find(e,{name:"auth0-authorization-extension"});return{exists:!!t,enabled:!!t&&t.enabled}}).then(r=>{e.storage.getStatus().then(e=>t({rule:r,database:e})).catch(()=>t({rule:r,database:{size:0,type:"unknown"}}))}).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t){e.exports=(()=>({method:"GET",path:"/api/configuration",config:{auth:{strategies:["jwt"],scope:["read:configuration"]}},handler:(e,t)=>e.storage.getConfiguration().then(e=>t(e)).catch(e=>t.error(e))}))},function(e,t){e.exports=(()=>({method:"GET",path:"/api/configuration/export",config:{auth:{strategies:["jwt"],scope:["read:configuration"]}},handler:(e,t)=>e.storage.provider&&e.storage.provider.storageContext&&"function"==typeof e.storage.provider.storageContext.read?e.storage.provider.storageContext.read().then(e=>t(e)).catch(e=>t.error(e)):t.error(new Error('Unable to use "export" without proper storage'))}))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(53);e.exports=(()=>({method:"POST",path:"/api/configuration/import",config:{auth:{strategies:["jwt"],scope:["update:configuration"]},validate:{payload:t.default}},handler:(e,t)=>e.storage.provider&&e.storage.provider.storageContext&&"function"==typeof e.storage.provider.storageContext.write?e.storage.provider.storageContext.storage&&e.storage.provider.storageContext.storage.set?e.storage.provider.storageContext.storage.set(e.payload,{force:!0},e=>e?t.error(e):t().code(204)):e.storage.provider.storageContext.write(e.payload).then(()=>t().code(204)).catch(e=>t.error(e)):t.error(new Error('Unable to use "import" without proper storage'))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a),s=r(54);t.default=n.a.object().keys({configuration:n.a.array().items((e=>e.keys({_id:n.a.string().required()}))(s.default)),groups:n.a.array().items(n.a.object()),roles:n.a.array().items(n.a.object()),permissions:n.a.array().items(n.a.object()),applications:n.a.array().items(n.a.object()),rules:n.a.array().items(n.a.object())})},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({groupsInToken:n.a.boolean(),rolesInToken:n.a.boolean(),permissionsInToken:n.a.boolean(),persistGroups:n.a.boolean(),persistRoles:n.a.boolean(),persistPermissions:n.a.boolean(),groupsPassthrough:n.a.boolean(),rolesPassthrough:n.a.boolean(),permissionsPassthrough:n.a.boolean()})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(54),s=r(56),i=r(45);e.exports=(e=>({method:"PATCH",path:"/api/configuration",config:{auth:{strategies:["jwt"],scope:["update:configuration"]},pre:[e.handlers.managementClient],validate:{options:{allowUnknown:!1},payload:n.default}},handler:(e,t)=>{const r=e.payload;Object(s.default)(e.storage,e.pre.auth0,r,e.auth.credentials.email||"unknown").then(t=>{Object(i.default)(e.pre.auth0,"rules",{fields:"name,id"}).then(r=>{const n={name:"auth0-authorization-extension",enabled:!0,script:t},s=a.a.find(r,{name:n.name});return s?e.pre.auth0.rules.update({id:s.id},n):e.pre.auth0.rules.create({stage:"login_success",...n})})}).then(()=>e.storage.updateConfiguration(r)).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(36),n=r.n(a),s=r(2),i=r(57),o=r(58),u=r.n(o);t.default=((e,t,r={},a="")=>e.getApiKey().then(r=>r?null:Object(i.default)(e,t)).then(()=>n.a.render(u.a,{extensionUrl:Object(s.default)("PUBLIC_WT_URL").replace(/\/$/g,""),updateTime:()=>(new Date).toISOString(),config:r,userName:a})))},function(e,t,r){"use strict";r.r(t);var a=r(27),n=r.n(a),s=r(2);t.default=((e,t)=>{const r=n.a.randomBytes(32).toString("hex"),a=(e=>n.a.createHmac("sha256",`${e} + ${Object(s.default)("AUTH0_CLIENT_SECRET")}`).update(Object(s.default)("EXTENSION_SECRET")).digest("hex"))(r);return t.rulesConfigs.set({key:"AUTHZ_EXT_API_KEY"},{value:a}).then(()=>e.updateApiKey(r)).then(()=>a)})},function(e,t){e.exports="/*\n*  This rule been automatically generated by auth0-authz-extension\n*  Updated by <%= userName %>, <%= updateTime() %>\n */\nfunction (user, context, callback) {\n  var _ = require('lodash');\n  var EXTENSION_URL = \"<%= extensionUrl %>\";\n\n  var audience = '';\n  audience = audience || (context.request && context.request.query && context.request.query.audience);\n  if (audience === 'urn:auth0-authz-api') {\n    return callback(new UnauthorizedError('no_end_users'));\n  }\n\n  audience = audience || (context.request && context.request.body && context.request.body.audience);\n  if (audience === 'urn:auth0-authz-api') {\n    return callback(new UnauthorizedError('no_end_users'));\n  }\n\n  getPolicy(user, context, function(err, res, data) {\n    if (err) {\n      console.log('Error from Authorization Extension:', err);\n      return callback(new UnauthorizedError('Authorization Extension: ' + err.message));\n    }\n\n    if (res.statusCode !== 200) {\n      console.log('Error from Authorization Extension:', res.body || res.statusCode);\n      return callback(\n        new UnauthorizedError('Authorization Extension: ' + ((res.body && (res.body.message || res.body) || res.statusCode)))\n      );\n    }\n\n    // Update the user object.<% if (config.groupsInToken && !config.groupsPassthrough) { %>\n    user.groups = data.groups;<% } %><% if (config.groupsInToken && config.groupsPassthrough) { %>\n    user.groups = mergeRecords(user.groups, data.groups);<% } %><% if (config.rolesInToken && !config.rolesPassthrough) { %>\n    user.roles = data.roles;<% } %><% if (config.rolesInToken && config.rolesPassthrough) { %>\n    user.roles = mergeRecords(user.roles, data.roles);<% } %><% if (config.permissionsInToken && !config.permissionsPassthrough) { %>\n    user.permissions = data.permissions;<% } %><% if (config.permissionsInToken && config.permissionsPassthrough) { %>\n    user.permissions = mergeRecords(user.permissions, data.permissions);<% } %>\n<% if (config.persistGroups || config.persistRoles || config.persistPermissions) { %>\n    // Store this in the user profile (app_metadata).\n    saveToMetadata(user, data.groups, data.roles, data.permissions, function(err) {\n      return callback(err, user, context);\n    });\n<% } else { %>\n    return callback(null, user, context);\n<% } %>  });\n  \n  // Convert groups to array\n  function parseGroups(data) {\n    if (typeof data === 'string') {\n      // split groups represented as string by spaces and/or comma\n      return data.replace(/,/g, ' ').replace(/\\s+/g, ' ').split(' ');\n    }\n    return data;\n  }\n\n  // Get the policy for the user.\n  function getPolicy(user, context, cb) {\n    request.post({\n      url: EXTENSION_URL + \"/api/users/\" + user.user_id + \"/policy/\" + context.clientID,\n      headers: {\n        \"x-api-key\": configuration.AUTHZ_EXT_API_KEY\n      },\n      json: {\n        connectionName: context.connection || user.identities[0].connection,\n        groups: parseGroups(user.groups)\n      },\n      timeout: 5000\n    }, cb);\n  }<% if (config.persistGroups || config.persistRoles || config.persistPermissions) { %>\n\n  // Store authorization data in the user profile so we can query it later.\n  function saveToMetadata(user, groups, roles, permissions, cb) {\n    user.app_metadata = user.app_metadata || {};\n    user.app_metadata.authorization = {<% if (config.persistGroups && !config.groupsPassthrough) { %>\n      groups: groups,<% } %><% if (config.persistGroups && config.groupsPassthrough) { %>\n      groups: mergeRecords(user.groups, groups),<% } %><% if (config.persistRoles && !config.rolesPassthrough) { %>\n      roles: roles,<% } %><% if (config.persistRoles && config.rolesPassthrough) { %>\n      roles: mergeRecords(user.roles, roles),<% } %><% if (config.persistPermissions && !config.permissionsPassthrough) { %>\n      permissions: permissions<% } %><% if (config.persistPermissions && config.permissionsPassthrough) { %>\n      permissions: mergeRecords(user.permissions, permissions)<% } %>\n    };\n\n    auth0.users.updateAppMetadata(user.user_id, user.app_metadata)\n    .then(function() {\n      cb();\n    })\n    .catch(function(err){\n      cb(err);\n    });\n  }<% } %><% if (config.groupsPassthrough || config.rolesPassthrough || config.permissionsPassthrough) { %>\n\n  // Merge the IdP records with the records of the extension.\n  function mergeRecords(idpRecords, extensionRecords) {\n    idpRecords = idpRecords || [ ];\n    extensionRecords = extensionRecords || [ ];\n\n    if (!Array.isArray(idpRecords)) {\n      idpRecords = idpRecords.replace(/,/g, ' ').replace(/\\s+/g, ' ').split(' ');\n    }\n\n    return _.uniq(_.union(idpRecords, extensionRecords));\n  }<% } %>\n}"},function(e,t,r){"use strict";r.r(t),function(e){var t=r(57);e.exports=(e=>({method:"PATCH",path:"/api/configuration/rotate-apikey",config:{auth:{strategies:["jwt"],scope:["update:configuration"]},pre:[e.handlers.managementClient]},handler:(e,r)=>Object(t.default)(e.storage,e.pre.auth0).then(e=>r({hash:e})).catch(e=>r.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(30);e.exports=(()=>({method:"GET",path:"/api/configuration/resource-server",config:{auth:{strategies:["jwt"],scope:["read:resource-server"]}},handler:(e,r)=>Object(t.getApi)(e).then(e=>r({apiAccess:!!e.identifier,token_lifetime:e.token_lifetime})).catch(e=>r.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(30);e.exports=(()=>({method:"PATCH",path:"/api/configuration/resource-server",config:{auth:{strategies:["jwt"],scope:["update:resource-server"]},validate:{payload:{apiAccess:a.a.boolean().required(),token_lifetime:a.a.number().integer()}}},handler:(e,t)=>e.payload.apiAccess?Object(n.getApi)(e).then(t=>t?Object(n.updateApi)(e,e.payload.token_lifetime):Object(n.createApi)(e,e.payload.token_lifetime)).then(()=>t().code(204)).catch(e=>t.error(e)):Object(n.deleteApi)(e).then(()=>t().code(204)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(30);e.exports=(()=>({method:"POST",path:"/api/configuration/resource-server",config:{auth:{strategies:["jwt"],scope:["create:resource-server"]}},handler:(e,r)=>Object(t.createApi)(e).then(e=>r(e)).catch(e=>r.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(30);e.exports=(()=>({method:"DELETE",path:"/api/configuration/resource-server",config:{auth:{strategies:["jwt"],scope:["delete:resource-server"]}},handler:(e,r)=>Object(t.deleteApi)(e).then(()=>r().code(204)).catch(e=>r.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(45);e.exports=(e=>({method:"GET",path:"/api/connections",config:{auth:{strategies:["jwt"],scope:["read:connections"]},pre:[e.handlers.managementClient]},handler:(e,t)=>Object(n.default)(e.pre.auth0,"connections",{fields:"id,name,strategy"}).then(e=>a.a.chain(e).sortBy(e=>e.name.toLowerCase()).value()).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(2),s=r(30),i=r(45);e.exports=(e=>({method:"DELETE",path:"/.extensions/on-uninstall",config:{auth:!1,pre:[e.handlers.validateHookToken("/.extensions/on-uninstall"),e.handlers.managementClient]},handler:(e,t)=>{Object(i.default)(e.pre.auth0,"rules",{fields:"name,id"}).then(t=>{const r=a.a.find(t,{name:"auth0-authorization-extension"});return r?e.pre.auth0.rules.delete({id:r.id}):Promise.resolve()}).then(()=>Object(s.deleteApi)(e,!0)).then(()=>e.pre.auth0.clients.delete({client_id:Object(n.default)("AUTH0_CLIENT_ID")})).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t){e.exports=(e=>({method:"PUT",path:"/.extensions/on-update",config:{auth:!1,pre:[e.handlers.validateHookToken("/.extensions/on-update"),e.handlers.managementClient]},handler:(e,t)=>{t().code(204)}}))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"DELETE",path:"/api/permissions/{id}",config:{auth:{strategies:["jwt"],scope:["delete:permissions"]},description:"Delete a permission.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()}}},handler:(e,t)=>{e.storage.deletePermission(e.params.id).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"GET",path:"/api/permissions/{id}",config:{auth:{strategies:["jwt"],scope:["read:permissions"]},description:"Get a single permission based on its unique identifier.",tags:["api"],validate:{params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.storage.getPermission(e.params.id).then(e=>t({_id:e._id,name:e.name,description:e.description})).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n);e.exports=(()=>({method:"GET",path:"/api/permissions",config:{auth:{strategies:["jwt"],scope:["read:permissions"]},description:"Get all permissions in the system.",tags:["api"],validate:{query:{q:s.a.string().max(1e3).allow("").default(""),field:s.a.string().max(1e3).allow("").default("")}}},handler:(e,t)=>e.storage.getPermissions().then(t=>({permissions:a.a.filter(t,t=>{const r=e.query.q;if(!r)return!0;const n=e.query.field;return a.a.includes(t[n].toLowerCase(),r.toLowerCase())}),total:t.length})).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(71);e.exports=(()=>({method:"POST",path:"/api/permissions",config:{auth:{strategies:["jwt"],scope:["create:permissions"]},description:"Create a new permission.",tags:["api"],validate:{options:{allowUnknown:!1},payload:t.default}},handler:(e,t)=>{const r=e.payload;return e.storage.createPermission(r).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({name:n.a.string().min(1).max(100).required(),description:n.a.string().min(1).max(500).required(),applicationType:n.a.string().valid("client","resource_server").required(),applicationId:n.a.string().min(1).max(500).required()})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(71);e.exports=(()=>({method:"PUT",path:"/api/permissions/{id}",config:{auth:{strategies:["jwt"],scope:["update:permissions"]},description:"Update a permission.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;return e.storage.updatePermission(e.params.id,r).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"DELETE",path:"/api/roles/{id}",config:{auth:{strategies:["jwt"],scope:["delete:roles"]},description:"Delete a role.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()}}},handler:(e,t)=>{e.storage.deleteRole(e.params.id).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"GET",path:"/api/roles/{id}",config:{auth:{strategies:["jwt"],scope:["read:roles"]},description:"Get a single role based on its unique identifier.",tags:["api"],validate:{params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.storage.getRole(e.params.id).then(e=>t({_id:e._id,name:e.name,description:e.description})).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n);e.exports=(()=>({method:"GET",path:"/api/roles",config:{auth:{strategies:["jwt"],scope:["read:roles"]},description:"Get all roles in the system.",tags:["api"],validate:{query:{q:s.a.string().max(1e3).allow("").default(""),field:s.a.string().max(1e3).allow("").default("")}}},handler:(e,t)=>e.storage.getRoles().then(t=>({roles:a.a.filter(t,t=>{const r=e.query.q;if(!r)return!0;const n=e.query.field;return a.a.includes(t[n].toLowerCase(),r.toLowerCase())}),total:t.length})).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(77);e.exports=(()=>({method:"POST",path:"/api/roles",config:{auth:{strategies:["jwt"],scope:["create:roles"]},description:"Create a new role.",tags:["api"],validate:{options:{allowUnknown:!1},payload:n.default}},handler:(e,t)=>{const r=e.payload;return e.storage.getPermissions().then(n=>(r.permissions.forEach(e=>{const t=a.a.find(n,{_id:e});if(t&&t.applicationId!==r.applicationId)throw new Error(`The permission '${t.name}' is linked to a different application.`)}),e.storage.createRole(r).then(e=>t(e)))).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({name:n.a.string().min(1).max(50).required(),description:n.a.string().min(1).max(500).required(),applicationType:n.a.string().valid("client","resource_server").required(),applicationId:n.a.string().min(1).max(500).required(),permissions:n.a.array().items(n.a.string().guid()).default([])})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n),i=r(77);e.exports=(()=>({method:"PUT",path:"/api/roles/{id}",config:{auth:{strategies:["jwt"],scope:["update:roles"]},description:"Update a role.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:s.a.string().guid().required()},payload:i.default}},handler:(e,t)=>{const r=e.payload;return e.storage.getPermissions().then(e=>{r.permissions.forEach(t=>{const n=a.a.find(e,{_id:t});if(n&&n.applicationId!==r.applicationId)throw new Error(`The permission '${n.name}' is linked to a different application.`)})}).then(()=>e.storage.getRole(e.params.id)).then(a=>{if(a.applicationId!==r.applicationId)throw new Error("The 'applicationId' of a role cannot be changed.");return e.storage.updateRole(e.params.id,r).then(e=>t(e))}).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"DELETE",path:"/api/groups/{id}",config:{auth:{strategies:["jwt"],scope:["delete:groups"]},description:"Delete a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()}}},handler:(e,t)=>{e.storage.deleteGroup(e.params.id).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(42);e.exports=(()=>({method:"GET",path:"/api/groups/{id}",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:'Get a single group based on its unique identifier. Add "?expand" to also load all roles and permissions for this group.',tags:["api"],validate:{query:{expand:a.a.boolean()},params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.query.expand?Object(n.getGroupExpanded)(e.storage,e.params.id).then(e=>t(e)).catch(e=>t.error(e)):e.storage.getGroup(e.params.id).then(e=>t({_id:e._id,name:e.name,description:e.description})).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n);e.exports=(()=>({method:"GET",path:"/api/groups",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get all groups in the system.",tags:["api"],validate:{query:{q:s.a.string().max(1e3).allow("").default(""),field:s.a.string().max(1e3).allow("").default("")}}},handler:(e,t)=>e.storage.getGroups().then(e=>e.map(e=>{const t=e;return t.mappings=t.mappings||[],t.members=t.members||[],t})).then(t=>({groups:a.a.filter(t,t=>{const r=e.query.q;if(!r)return!0;const n=e.query.field;return a.a.includes(t[n].toLowerCase(),r.toLowerCase())}),total:t.length})).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(83);e.exports=(()=>({method:"POST",path:"/api/groups",config:{auth:{strategies:["jwt"],scope:["create:groups"]},description:"Create a new group.",tags:["api"],validate:{options:{allowUnknown:!1},payload:t.default}},handler:(e,t)=>{const r=e.payload;return e.storage.createGroup(r).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({name:n.a.string().min(1).max(50).required(),description:n.a.string().min(1).max(500).required()})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(83);e.exports=(()=>({method:"PUT",path:"/api/groups/{id}",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Update a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;return e.storage.updateGroup(e.params.id,r).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"DELETE",path:"/api/groups/{id}/roles",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Delete one or more roles from a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:a.a.array().items(a.a.string().guid()).required().min(1)}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(r.forEach(e=>{const r=t.roles.indexOf(e);r>-1&&t.roles.splice(r,1)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(e=>({method:"GET",path:"/api/groups/{id}/roles",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the roles for a group.",tags:["api"],pre:[e.handlers.managementClient],validate:{params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.storage.getGroup(e.params.id).then(e=>e.roles||[]).then(t=>e.storage.getRoles().then(e=>e.filter(e=>t.indexOf(e._id)>-1))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n),i=r(42);e.exports=(e=>({method:"GET",path:"/api/groups/{id}/roles/nested",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the nested roles for a group.",tags:["api"],pre:[e.handlers.managementClient],validate:{params:{id:s.a.string().guid().required()}}},handler:(e,t)=>e.storage.getGroups().then(t=>{const r=a.a.find(t,{_id:e.params.id});return Object(i.getParentGroups)(t,[r])}).then(t=>e.storage.getRoles().then(e=>Object(i.getRolesForGroups)(t,e))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(()=>({method:"PATCH",path:"/api/groups/{id}/roles",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Add one or more roles to a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:a.a.array().items(a.a.string().guid()).required().min(1)}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(t.roles||(t.roles=[]),r.forEach(e=>{-1===t.roles.indexOf(e)&&t.roles.push(e)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(90);e.exports=(()=>({method:"DELETE",path:"/api/groups/{id}/nested",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Delete one or more nested groups from a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(r.forEach(e=>{const r=t.nested.indexOf(e);r>-1&&t.nested.splice(r,1)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.array().items(n.a.string().guid()).required().min(1)},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(9),s=r.n(n);e.exports=(()=>({method:"GET",path:"/api/groups/{id}/nested",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the nested groups for a group.",tags:["api"],validate:{params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.storage.getGroups().then(t=>{const r=s.a.find(t,{_id:e.params.id});return r.nested||(r.nested=[]),s.a.filter(t,e=>r.nested.indexOf(e._id)>-1)}).then(e=>s.a.sortByOrder(e,["name"],[!0])).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(90);e.exports=(()=>({method:"PATCH",path:"/api/groups/{id}/nested",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Add one or more nested groups in a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(t.nested||(t.nested=[]),r.forEach(r=>{-1===t.nested.indexOf(r)&&r!==e.params.id&&t.nested.push(r)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(42);e.exports=(e=>({method:"GET",path:"/api/groups/{id}/mappings",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the mappings for a group.",tags:["api"],pre:[e.handlers.managementClient],validate:{params:{id:a.a.string().guid().required()}}},handler:(e,t)=>e.storage.getGroup(e.params.id).then(e=>e.mappings||[]).then(t=>Object(n.getMappingsWithNames)(e.pre.auth0,t)).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n),i=r(95);e.exports=(()=>({method:"DELETE",path:"/api/groups/{id}/mappings",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Delete one or more group mappings from a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:s.a.string().guid().required()},payload:i.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(r.forEach(e=>{const r=a.a.find(t.mappings,{_id:e});r&&t.mappings.splice(t.mappings.indexOf(r),1)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.array().items(n.a.string().guid()).required().min(1)},function(e,t,r){"use strict";r.r(t),function(e){var t=r(97),a=r.n(t),n=r(98);e.exports=(()=>({method:"PATCH",path:"/api/groups/{id}/mappings",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Create one or more mappings in a group.",tags:["api"],validate:{options:{allowUnknown:!1},payload:n.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(t.mappings||(t.mappings=[]),r.forEach(e=>{t.mappings.push({_id:a.a.v4(),groupName:e.groupName,connectionName:e.connectionName})}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t){e.exports=require("node-uuid")},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a),s=r(99);t.default=n.a.array().items(s.default).required().min(1)},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.object().keys({groupName:n.a.string().min(1).max(50).required(),connectionName:n.a.string().min(1).max(50).required()})},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(101);e.exports=(()=>({method:"DELETE",path:"/api/groups/{id}/members",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Delete one or more members from a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(r.forEach(e=>{const r=t.members.indexOf(e);r>-1&&t.members.splice(r,1)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t);var a=r(40),n=r.n(a);t.default=n.a.array().items(n.a.string()).required().min(1)},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(103);e.exports=(e=>({method:"GET",path:"/api/groups/{id}/members",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the members for a group.",tags:["api"],pre:[e.handlers.managementClient],validate:{params:{id:a.a.string().guid().required()},query:{per_page:a.a.number().integer().min(1).max(25).default(25),page:a.a.number().integer().min(0).default(0)}}},handler:(e,t)=>e.storage.getGroup(e.params.id).then(t=>Object(n.getUsersById)(e.pre.auth0,t.members||[],e.query.page,e.query.per_page)).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),r.d(t,"getUsersById",function(){return p});var a=r(9),n=r.n(a),s=r(104),i=r.n(s),o=r(10),u=r.n(o),c=r(46);function p(e,t,r,a){return new u.a((s,o)=>{const u=[],p=t.length;r=r-1<0?0:r-1,t=t.splice(r*a,a),i.a.eachLimit(t,10,(t,r)=>{Object(c.default)(e,e.users.get,[{id:t}]).then(e=>{u.push(e),r()}).catch(e=>{const a=e&&(e.name||e.statusCode);return u.push({user_id:t,name:`<Error: ${a}>`,email:t,identities:[{connection:"N/A"}]}),r()})},e=>{if(e)return o(e);const t=n.a.sortByOrder(u,"user_id");return s({total:p,users:t})})})}},function(e,t){e.exports=require("async")},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(40),s=r.n(n),i=r(103),o=r(42);e.exports=(e=>({method:"GET",path:"/api/groups/{id}/members/nested",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Get the nested members for a group.",tags:["api"],pre:[e.handlers.managementClient],validate:{params:{id:s.a.string().guid().required()},query:{per_page:s.a.number().integer().min(1).max(25).default(25),page:s.a.number().integer().min(0).default(0)}}},handler:(e,t)=>e.storage.getGroups().then(t=>{const r=a.a.find(t,{_id:e.params.id}),n=Object(o.getChildGroups)(t,[r]);return Object(o.getMembers)(n)}).then(t=>{const r=t?t.map(e=>e.userId):[];return Object(i.getUsersById)(e.pre.auth0,r,e.query.page,e.query.per_page).then(e=>{const r=t.length,n=e.users.map(e=>{let r=a.a.find(t,{userId:e.user_id});return r&&(r={_id:r.group._id,name:r.group.name,description:r.group.description}),{user:{user_id:e.user_id,name:e.name,nickname:e.nickname,email:e.email},group:r}});return{total:r,nested:a.a.sortByOrder(n,["user.name"],[!0])}})}).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(101);e.exports=(()=>({method:"PATCH",path:"/api/groups/{id}/members",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Add one or more members in a group.",tags:["api"],validate:{options:{allowUnknown:!1},params:{id:a.a.string().guid().required()},payload:n.default}},handler:(e,t)=>{const r=e.payload;e.storage.getGroup(e.params.id).then(t=>(t.members||(t.members=[]),r.forEach(e=>{-1===t.members.indexOf(e)&&t.members.push(e)}),e.storage.updateGroup(e.params.id,t))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(108);e.exports=(()=>({method:"GET",path:"/meta",config:{auth:!1},handler:(e,r)=>r(t)}))}.call(this,r(7)(e))},function(e){e.exports=JSON.parse('{"title":"Auth0 Authorization","name":"auth0-authz-mcastany","version":"2.9.0","author":"auth0","description":"This extension gives Auth0 customers the possibility to manage group memberships for their users.","type":"application","logoUrl":"https://cdn.auth0.com/extensions/auth0-authz/assets/logo.svg","initialUrlPath":"/admins/login","updateConfirmMessage":"Warning! Read the documentation about breaking changes (https://auth0.com/docs/extensions/authorization-extension) before updating the extension. If you are upgrading from 2.5 or older, you have to rotate your Api Key and republish the rule upon upgrade.","uninstallConfirmMessage":"You are about to uninstall the \\"Authorization Extension\\". If you proceed all your data in this extension will be lost. Do you want to continue?","repository":"https://github.com/auth0/auth0-authorization-extension","keywords":["auth0","extension"],"auth0":{"createClient":true,"onUninstallPath":"/.extensions/on-uninstall","onUpdatePath":"/.extensions/on-update","scopes":"read:connections read:resource_servers update:resource_servers delete:resource_servers read:clients delete:clients read:users read:rules create:rules update:rules_configs update:rules delete:rules"},"secrets":{"STORAGE_TYPE":{"description":"Choose the storage type for the database","type":"select","required":true,"default":"webtask","allowMultiple":false,"options":[{"value":"webtask","text":"Webtask Storage"},{"value":"s3","text":"Amazon S3"}]},"S3_BUCKET":{"description":"Your S3 Bucket","example":"my-bucket","required":true,"visibleIf":{"STORAGE_TYPE":"s3"}},"S3_PATH":{"description":"Path to the JSON file","required":true,"example":"/auth0-authz.json","default":"/auth0-authz.json","visibleIf":{"STORAGE_TYPE":"s3"}},"S3_KEY":{"description":"Your S3 Key ID","required":true,"example":"AKIAJL.........","visibleIf":{"STORAGE_TYPE":"s3"}},"S3_SECRET":{"description":"Your S3 Key Secret","required":true,"example":"r3UOMBA......................","visibleIf":{"STORAGE_TYPE":"s3"}}}}')},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t);e.exports=(e=>({method:"GET",path:"/api/users/{id}",config:{auth:{strategies:["jwt"],scope:["read:users"]},description:"Get a single user based on its unique identifier.",validate:{params:{id:a.a.string().required()}},pre:[e.handlers.managementClient]},handler:(e,t)=>e.pre.auth0.users.get({id:e.params.id}).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(2);e.exports=(e=>({method:"GET",path:"/api/users",config:{auth:{strategies:["jwt"],scope:["read:users"]},description:"Get all users.",validate:{query:{q:a.a.string().max(1e3).allow("").default(""),field:a.a.string().max(1e3).allow("").default(""),per_page:a.a.number().integer().min(1).max(100).default(100),page:a.a.number().integer().min(0).default(0)}},pre:[e.handlers.managementClient]},handler:(e,t)=>{const r=e.query.page-1<0?0:e.query.page-1,a={sort:"last_login:-1",q:e.query.field?`${e.query.field}:${e.query.q}`:e.query.q,per_page:e.query.per_page||100,page:r||0,include_totals:!0,fields:"user_id,name,email,identities,picture,last_login,logins_count,multifactor,blocked",search_engine:"auth0.auth0.com"!==Object(n.default)("AUTH0_RTA").replace("https://","")?"v2":"v3"};e.pre.auth0.users.getAll(a).then(e=>t(e)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(9),s=r.n(n),i=r(42);e.exports=(()=>({method:"GET",path:"/api/users/{id}/groups",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:'Get the groups for a user. Add "?expand" to also load all roles and permissions for these groups.',tags:["api"],validate:{params:{id:a.a.string().required()}}},handler:(e,t)=>e.query.expand?e.storage.getGroups().then(t=>s.a.filter(t,t=>s.a.includes(t.members,e.params.id))).then(t=>Object(i.getGroupsExpanded)(e.storage,t)).then(e=>t(e)).catch(e=>t.error(e)):e.storage.getGroups().then(t=>s.a.filter(t,t=>s.a.includes(t.members,e.params.id))).then(e=>e.map(e=>({_id:e._id,name:e.name,description:e.description}))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(9),s=r.n(n),i=r(42);e.exports=(()=>({method:"GET",path:"/api/users/{id}/groups/calculate",config:{auth:{strategies:["jwt"],scope:["read:groups"]},description:"Calculate the group memberships for a user (including nested groups).",tags:["api"],validate:{params:{id:a.a.string().required()}}},handler:(e,t)=>e.storage.getGroups().then(t=>Object(i.getParentGroups)(t,s.a.filter(t,t=>s.a.includes(t.members,e.params.id)))).then(e=>e.map(e=>({_id:e._id,name:e.name,description:e.description}))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(10),a=r.n(t),n=r(40),s=r.n(n),i=r(9),o=r.n(i);e.exports=(()=>({method:"PATCH",path:"/api/users/{id}/groups",config:{auth:{strategies:["jwt"],scope:["update:groups"]},description:"Add a single user to groups.",tags:["api"],validate:{params:{id:s.a.string().required()},payload:s.a.array().items(s.a.string()).required().min(1)}},handler:(e,t)=>{const r=e.payload,n=/^(\{{0,1}([0-9a-fA-F]){8}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){12}\}{0,1})$/.test(r[0])?"_id":"name";e.storage.getGroups().then(e=>o.a.filter(e,e=>o.a.includes(r,e[n]))).then(t=>a.a.each(t,t=>(t.members||(t.members=[]),-1===t.members.indexOf(e.params.id)&&t.members.push(e.params.id),e.storage.updateGroup(t._id,t)))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(9),s=r.n(n);e.exports=(()=>({method:"GET",path:"/api/users/{id}/roles",config:{auth:{strategies:["jwt"],scope:["read:roles"]},description:"Get the roles for a user.",tags:["api"],validate:{params:{id:a.a.string().required()}}},handler:(e,t)=>e.storage.getRoles().then(t=>s.a.filter(t,t=>s.a.includes(t.users,e.params.id))).then(e=>e.map(e=>({_id:e._id,name:e.name,applicationId:e.applicationId,description:e.description}))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(40),a=r.n(t),n=r(42);e.exports=(()=>({method:"GET",path:"/api/users/{id}/roles/calculate",config:{auth:{strategies:["jwt"],scope:["read:roles"]},description:"Calculate the roles assigned to the user (including through group memberships).",tags:["api"],validate:{params:{id:a.a.string().required()}}},handler:(e,t)=>Object(n.getRolesForUser)(e.storage,e.params.id).then(e=>e.map(e=>({_id:e._id,name:e.name,applicationId:e.applicationId,description:e.description}))).then(e=>t(e)).catch(e=>t.error(e))}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(10),a=r.n(t),n=r(40),s=r.n(n);e.exports=(()=>({method:"DELETE",path:"/api/users/{id}/roles",config:{auth:{strategies:["jwt"],scope:["update:roles"]},description:"Remove a single user from roles.",tags:["api"],validate:{params:{id:s.a.string().required()},payload:s.a.array().items(s.a.string().guid()).required().min(1)}},handler:(e,t)=>{const r=e.payload;return a.a.each(r,t=>e.storage.getRole(t).then(r=>{r.users||(r.users=[]);const a=r.users.indexOf(e.params.id);return a>-1&&r.users.splice(a,1),e.storage.updateRole(t,r)})).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(9),a=r.n(t),n=r(10),s=r.n(n),i=r(40),o=r.n(i);e.exports=(()=>({method:"PATCH",path:"/api/users/{id}/roles",config:{auth:{strategies:["jwt"],scope:["update:roles"]},description:"Add a single user to roles.",tags:["api"],validate:{params:{id:o.a.string().required()},payload:o.a.array().items(o.a.string()).required().min(1)}},handler:(e,t)=>{const r=e.payload,n=/^(\{{0,1}([0-9a-fA-F]){8}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){4}-?([0-9a-fA-F]){12}\}{0,1})$/.test(r[0])?"_id":"name";e.storage.getRoles().then(e=>a.a.filter(e,e=>a.a.includes(r,e[n]))).then(t=>s.a.each(t,t=>(t.users||(t.users=[]),-1===t.users.indexOf(e.params.id)&&t.users.push(e.params.id),e.storage.updateRole(t._id,t)))).then(()=>t().code(204)).catch(e=>t.error(e))}}))}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(26),a=r.n(t),n=r(4),s=r.n(n);function i(e){return this.response(a.a.notFound(e))}function o(e){s.a.error(e);const t=e.message&&e.message.error||e.message||e.code||e.name||e.text||e.description||e;return e.message&&429===e.message.statusCode?this.response(a.a.tooManyRequests(t)):this.response(a.a.badRequest(t))}function u(e){return this.response(a.a.unauthorized(e))}e.exports.register=((e,t,r)=>{e.decorate("reply","notFound",i),e.decorate("reply","error",o),e.decorate("reply","unauthorized",u),r()}),e.exports.register.attributes={name:"reply-decorators"}}.call(this,r(7)(e))},function(e,t,r){"use strict";r.r(t),function(e){var t=r(11);e.exports.register=((e,r,a)=>{const n=Object(t.getDb)();e.decorate("server","storage",n),e.decorate("request","storage",n),a()}),e.exports.register.attributes={name:"storage"}}.call(this,r(7)(e))}]);