module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){const n=r(1),s=r(2),o=r(4),i=(e,t)=>(o.info("Starting Authorization Extension - Version:","2.9.0"),o.info(" > WT_URL:",e("WT_URL")),o.info(" > PUBLIC_WT_URL:",e("PUBLIC_WT_URL")),r(6)(e,t));let a=(e,t,r)=>{setImmediate(()=>{t.x_wt&&t.x_wt.ectx&&t.x_wt.ectx.PUBLIC_WT_URL||!1||s.setValue("PUBLIC_WT_URL",n.urlHelpers.getWebtaskUrl(t)),(a=n.createServer(i))(e,t,r)})};e.exports=((e,t,r)=>{a(e,t,r)})},function(e,t){e.exports=require("auth0-extension-hapi-tools@1.3.1")},function(e,t,r){const{config:n}=r(3);e.exports=n()},function(e,t){e.exports=require("auth0-extension-tools@1.3.2")},function(e,t,r){const n=r(5);n.emitErrs=!0;const s=new n.Logger({transports:[new n.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=s},function(e,t){e.exports=require("winston@1.0.0")},function(e,t,r){const n=r(2),s=r(7),{init:o}=r(11),i=r(12),a=r(15),u=r(4);e.exports=((e,t,r)=>(null==r&&(r=(e=>{e?(u.error("Hapi initialization failed."),u.error(e)):u.info("Hapi initialization completed.")})),n.setProvider(t=>e(t)||Object({WARN_DB_SIZE:409600,MAX_MULTISELECT_USERS:5,MULTISELECT_DEBOUNCE_MS:250,PER_PAGE:10,NODE_ENV:"production",CLIENT_VERSION:"2.9.0"})[t]),o(new s({provider:i(t)})),a(r)))},function(e,t,r){var n=r(8);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const i=r(9),a=r(10),{ArgumentError:u,ValidationError:l}=r(3),p=r(2),c=(e=[],t="Record with that identifier is already exists.",r)=>0===e.length?null:r&&1===e.length&&e[0]._id===r?null:a.reject(new l(t));e.exports=class{constructor(e={}){if(!e.provider)throw new u("The 'provider' has to be set when initializing the database.");this.provider=e.provider}getStatus(){return p("STORAGE_TYPE")&&"webtask"!==p("STORAGE_TYPE")?a.resolve({size:null,type:p("STORAGE_TYPE")}):this.provider.storageContext.read().then(e=>({size:Buffer.byteLength(JSON.stringify(e),"utf8"),type:"default"}))}canChange(e,t,r){return this.provider.getAll(e).then(e=>i.filter(e,e=>e[t]&&i.includes(e[t],r))).then(r=>{if(r.length){const n=r.map(e=>e.name).join(", "),s=`Unable to touch ${t} while used in ${e}: ${n}`;return a.reject(new l(s))}return a.resolve()})}getApiKey(){return this.provider.getAll("configuration").then(e=>e.length?e[0].apikey:null)}updateApiKey(e){return this.provider.getAll("configuration").then(e=>e.length?e[0]:{}).then(t=>this.provider.update("configuration","v1",o(o({},t),{},{apikey:e}),!0))}getConfiguration(){return this.provider.getAll("configuration").then(e=>e.length?e[0]:null)}updateConfiguration(e){return this.provider.update("configuration","v1",e,!0)}getRules(){return this.provider.getAll("rules")}createRule(e){return this.provider.create("rules",e)}getPermissions(){return this.provider.getAll("permissions")}getPermission(e){return this.provider.get("permissions",e)}createPermission(e){return this.getPermissions().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()&&t.applicationId===e.applicationId),`Permission with name "${e.name}" already exists for this application`)).then(()=>this.provider.create("permissions",e))}updatePermission(e,t){return this.getPermissions().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.applicationId===t.applicationId),`Permission with name "${t.name}" already exists for this application`,e)).then(()=>this.canChange("roles","permissions",e)).then(()=>this.canChange("groups","permissions",e)).then(()=>this.provider.update("permissions",e,t))}deletePermission(e){return this.canChange("roles","permissions",e).then(()=>this.provider.delete("permissions",e))}getRoles(){return this.provider.getAll("roles")}getRole(e){return this.provider.get("roles",e)}createRole(e){return this.getRoles().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()&&t.applicationId===e.applicationId),`Role with name "${e.name}" already exists for this application`)).then(()=>this.provider.create("roles",e))}updateRole(e,t){return this.getRoles().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.applicationId===t.applicationId),`Role with name "${t.name}" already exists for this application`,e)).then(()=>this.provider.update("roles",e,t))}deleteRole(e){return this.canChange("groups","roles",e).then(()=>this.provider.delete("roles",e))}getGroups(){return this.provider.getAll("groups")}getGroup(e){return this.provider.get("groups",e)}createGroup(e){return this.getGroups().then(t=>c(t.filter(t=>t.name.toLowerCase()===e.name.toLowerCase()),`Group with name "${e.name}" already exists`)).then(()=>this.provider.create("groups",e))}updateGroup(e,t){return this.getGroups().then(r=>c(r.filter(e=>e.name.toLowerCase()===t.name.toLowerCase()),`Group with name "${t.name}" already exists`,e)).then(()=>this.provider.update("groups",e,t))}deleteGroup(e){return this.canChange("groups","nested",e).then(()=>this.provider.delete("groups",e))}getApplications(){return this.provider.getAll("applications")}getApplication(e){return this.provider.get("applications",e)}updateApplication(e,t){return this.provider.update("applications",e,t,!0)}}},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t){e.exports=require("lodash@3.10.1")},function(e,t){e.exports=require("bluebird@3.5.0")},function(e,t){let r=null;e.exports.init=(e=>{r=e}),e.exports.getDb=(()=>{if(!r)throw new Error("The database has not been initialized.");return r})},function(e,t,r){(function(t){const n=r(13),{S3StorageContext:s}=r(14),{FileStorageContext:o,WebtaskStorageContext:i,BlobRecordProvider:a}=r(3),u=r(2),l=r(4);e.exports=function(e){switch(u("STORAGE_TYPE")){case"s3":{l.info("Initializing the S3 Storage Context.");const e=new s({path:u("S3_PATH"),bucket:u("S3_BUCKET"),keyId:u("S3_KEY"),keySecret:u("S3_SECRET"),defaultData:{}});return new a(e,{concurrentWrites:!1})}case"webtask":default:{l.info("Initializing the Webtask Storage Context.");const r=e?new i(e,{force:0}):new o(n.join(t,"../../data.json"),{mergeWrites:!0});return new a(r,{concurrentWrites:!1})}}}}).call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("auth0-extension-s3-tools@1.1.1")},function(e,t,r){const n=r(16),s=r(17),o=r(18),i=r(19),a=r(20),u=r(21),l=r(22),p=r(23),c=r(2),d=r(4),h=r(24);e.exports=(e=>{const t={register:s,options:{ops:{interval:3e4},reporters:{console:[]}}},r={register:p,options:{documentationPage:!1,swaggerUI:!1}};t.options.reporters.console.push(new l({color:!!c("LOG_COLOR")})),t.options.reporters.console.push("stdout");const g=i({}),f=new n.Server;return f.connection({host:"localhost",port:3e3,routes:{cors:!0,validate:{failAction:g.failAction}}}),f.register([t,o,a,u,r,...h],t=>t?e(t,null):(d.debug=((...e)=>{f.log(["debug"],e.join(" "))}),d.info=((...e)=>{f.log(["info"],e.join(" "))}),d.error=((...e)=>{f.log(["error"],e.join(" "))}),e(null,f))),f.ext("onPreResponse",(e,t)=>(e.response&&e.response.isBoom&&e.response.output&&(f.log(["error"],`Request: ${e.method.toUpperCase()} ${e.url.path}`),f.log(["error"],`Response: ${JSON.stringify(e.response,null,2)}`)),t.continue())),f})},function(e,t){e.exports=require("@auth0/hapi@13.6.0")},function(e,t){e.exports=require("good@7.0.1")},function(e,t){e.exports=require("inert@4.0.1")},function(e,t){e.exports=require("relish@0.2.4")},function(e,t){e.exports=require("blipp@2.3.0")},function(e,t){e.exports=require("hapi-auth-jwt2@7.0.1")},function(e,t){e.exports=require("good-console@6.1.2")},function(e,t){e.exports=require("hapi-swagger@7.4.0")},function(e,t,r){e.exports=[{register:r(25)},{register:r(32)},{register:r(33)},{register:r(34)},{register:r(38)},{register:r(39)},{register:r(40)}]},function(e,t,r){const n=r(26),s=r(27),o=r(28),i=r(29),a=r(1),u=r(2),{scopes:l}=r(30),p=(e,t,r)=>{e.auth.scheme("extension-secret",()=>({authenticate:(e,t)=>{const r=e.headers["x-api-key"];return e.storage.getApiKey().then(e=>r&&r===(e=>s.createHmac("sha256",`${e} + ${u("AUTH0_CLIENT_SECRET")}`).update(u("EXTENSION_SECRET")).digest("hex"))(e)?t.continue({credentials:{user:"rule"}}):t(n.unauthorized("Invalid API Key")))}})),e.auth.strategy("extension-secret","extension-secret");const p={dashboardAdmin:{key:u("EXTENSION_SECRET"),verifyOptions:{audience:"urn:api-authz",issuer:u("PUBLIC_WT_URL"),algorithms:["HS256"]}},resourceServer:{key:o.hapiJwt2Key({cache:!0,rateLimit:!0,jwksRequestsPerMinute:2,jwksUri:`https://${u("AUTH0_DOMAIN")}/.well-known/jwks.json`}),verifyOptions:{audience:"urn:auth0-authz-api",issuer:`https://${u("AUTH0_DOMAIN")}/`,algorithms:["RS256"]}}};e.auth.strategy("jwt","jwt",{complete:!0,verifyFunc:(e,t,r)=>{if(!e)return r(null,!1);const s=t.headers.authorization;if(s&&0===s.indexOf("Bearer ")){const t=s.split(" ")[1];if(e&&e.payload&&e.payload.iss===`https://${u("AUTH0_DOMAIN")}/`)return p.resourceServer.key(e,(s,o)=>s?r(n.wrap(s),null,null):i.verify(t,o,p.resourceServer.verifyOptions,t=>t?r(n.unauthorized("Invalid token","Token"),null,null):e.payload.gty&&"client-credentials"!==e.payload.gty?r(n.unauthorized("Invalid token","Token"),null,null):e.payload.sub.endsWith("@clients")?(e.payload.scope&&"string"==typeof e.payload.scope&&(e.payload.scope=e.payload.scope.split(" ")),r(null,!0,e.payload)):r(n.unauthorized("Invalid token","Token"),null,null)));if(e&&e.payload&&e.payload.iss===u("PUBLIC_WT_URL"))return i.verify(t,p.dashboardAdmin.key,p.dashboardAdmin.verifyOptions,t=>t?r(n.unauthorized("Invalid token","Token"),null,null):e.payload.access_token&&e.payload.access_token.length?(e.payload.scope=l.map(e=>e.value),r(null,!0,e.payload)):r(n.unauthorized("Invalid token","Token"),null,null))}return r(null,!1)}}),e.auth.default("jwt");const c={register:a.plugins.dashboardAdminSession,options:{stateKey:"authz-state",nonceKey:"authz-nonce",sessionStorageKey:"authz:apiToken",rta:u("AUTH0_RTA").replace("https://",""),domain:u("AUTH0_DOMAIN"),scopes:"read:resource_servers create:resource_servers update:resource_servers delete:resource_servers read:clients read:connections read:rules create:rules update:rules update:rules_configs read:users",baseUrl:u("PUBLIC_WT_URL"),audience:"urn:api-authz",secret:u("EXTENSION_SECRET"),clientName:"Authorization Extension",onLoginSuccess:(e,t,r)=>e?(e.scope=l.map(e=>e.value),r(null,!0,e)):r(null,!1)}};e.register(c,e=>{e&&r(e),r()})};p.attributes={name:"auth"},e.exports=p},function(e,t){e.exports=require("boom@3.2.2")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("jwks-rsa@1.1.1")},function(e,t){e.exports=require("jsonwebtoken@7.1.9")},function(e,t,r){const n=r(10),s=r(31),{managementApi:o}=r(3),i=r(2),a=[{value:"read:users"},{value:"read:applications"},{value:"read:connections"},{value:"read:configuration"},{value:"update:configuration"},{value:"read:groups"},{value:"create:groups"},{value:"update:groups"},{value:"delete:groups"},{value:"read:roles"},{value:"create:roles"},{value:"update:roles"},{value:"delete:roles"},{value:"read:permissions"},{value:"create:permissions"},{value:"update:permissions"},{value:"delete:permissions"},{value:"read:resource-server"},{value:"create:resource-server"},{value:"update:resource-server"},{value:"delete:resource-server"}],u=(e,t,r,a)=>new n((u,l)=>(e=e,e.auth&&e.auth.credentials&&e.auth.credentials.access_token&&e.auth.credentials.access_token.length?n.resolve(e.auth.credentials.access_token):o.getAccessTokenCached(i("AUTH0_DOMAIN"),i("AUTH0_CLIENT_ID"),i("AUTH0_CLIENT_SECRET"))).then(e=>{s(r,`https://${i("AUTH0_DOMAIN")}/api/v2/${t}`).send(a||{}).set("Content-Type","application/json").set("Authorization",`Bearer ${e}`).end((e,t)=>e?l(e):u(t.body))}));var l;const p=e=>u(e,"resource-servers","GET").then(e=>{return e.filter(e=>"urn:auth0-authz-api"===e.identifier)[0]||{}}),c=(e,t)=>{return u(e,"resource-servers","POST",{name:"auth0-authorization-extension-api",identifier:"urn:auth0-authz-api",signing_alg:"RS256",scopes:a,token_lifetime:t})},d=a;e.exports={scopes:d,getApi:p,createApi:c,updateApi:(e,t)=>p(e).then(r=>r.id?u(e,`resource-servers/${r.id}`,"PATCH",{token_lifetime:t||86400}):c(e,t||86400)),deleteApi:(e,t)=>p(e).then(r=>r.id?u(e,`resource-servers/${r.id}`,"DELETE"):r.id||t?n.resolve():n.reject(new Error("Unable to disable resource-server. Is it enabled?")))}},function(e,t){e.exports=require("superagent@1.2.0")},function(e,t,r){(function(t){const n=r(13),s=(e,r,s)=>{e.route({method:"GET",path:"/app/{param*}",config:{auth:!1},handler:{directory:{path:n.join(t,"../../dist"),redirectToSlash:!0}}}),s()};s.attributes={name:"assets"},e.exports=s}).call(this,"/")},function(e,t,r){const{handlers:n}=r(1),s=r(2),o=r(4),i=r(3),a=r(26),u=(e,t,r)=>{e.decorate("server","handlers",{managementClient:n.managementApiClient({domain:s("AUTH0_DOMAIN"),clientId:s("AUTH0_CLIENT_ID"),clientSecret:s("AUTH0_CLIENT_SECRET"),logger:o.error}),validateHookToken:((e,t,r)=>{if(null===e||void 0===e)throw new i.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new i.ArgumentError(`The provided domain is invalid: ${e}`);if(null===t||void 0===t)throw new i.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new i.ArgumentError(`The provided webtaskUrl is invalid: ${t}`);if(null===r||void 0===r)throw new i.ArgumentError("Must provide the extensionSecret");if("string"!=typeof r||0===r.length)throw new i.ArgumentError(`The provided extensionSecret is invalid: ${r}`);return n=>{if(null===n||void 0===n)throw new i.ArgumentError("Must provide the hookPath");if("string"!=typeof n||0===n.length)throw new i.ArgumentError(`The provided hookPath is invalid: ${n}`);return{method(s,u){if(s.headers.authorization&&"Bearer"===s.headers.authorization.split(" ")[0]){const l=s.headers.authorization.split(" ")[1];try{if(o.info(`Validating hook token with signature: ${r.substr(0,4)}...`),i.validateHookToken(e,t,n,r,l))return u()}catch(e){return o.error("Invalid token:",l),u(a.wrap(e,401,e.message))}}const l=new i.HookTokenError(`Hook token missing for the call to: ${n}`);return u(a.unauthorized(l,401,l.message))}}}})(s("AUTH0_DOMAIN"),s("WT_URL"),s("EXTENSION_SECRET"))}),r()};u.attributes={name:"handlers"},e.exports=u},function(e,t,r){(function(t){r(8);const n=r(35),s=r(36),o=r(13),{urlHelpers:i}=r(1),a=r(2),u=r(37),l=["/","/api","/configuration","/configuration/rule","/configuration/api","/roles","/roles/{id}","/groups","/groups/{id}","/permissions","/permissions/{id}","/users","/users/{id}","/import-export"],p=(e,r,p)=>{l.map(r=>e.route((e=>({method:"GET",path:e,config:{description:"Render HTML",auth:!1},handler:(e,r)=>{const l={AUTH0_DOMAIN:a("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:a("AUTH0_CLIENT_ID"),BASE_URL:i.getBaseUrl(e),API_BASE:i.getBaseUrl(e),BASE_PATH:i.getBasePath(e),SEARCH_ENGINE:"auth0.auth0.com"!==a("AUTH0_RTA").replace("https://","")?"v2":"v3"},p=a("CLIENT_VERSION");return p?r(s.render(u,{config:l,assets:{version:p}})):n.readFile(o.join(t,"../../dist/manifest.json"),"utf8",(e,t)=>{const n={config:l,assets:{app:"/app/bundle.js"}};!e&&t&&(n.assets=JSON.parse(t),n.assets.app&&(n.assets.app=`/app/${n.assets.app}`),n.assets.vendors&&(n.assets.vendors=`/app/${n.assets.vendors}`),n.assets.style&&(n.assets.style=`/app/${n.assets.style}`)),r(s.render(u,n))})}}))(r))),p()};p.attributes={name:"html"},e.exports=p}).call(this,"/")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("ejs@2.3.1")},function(e,t){e.exports='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <title>Auth0 - Authorization</title>\n  <meta charset="UTF-8" />\n  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.8.10/lib/logos/img/favicon.png">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css">\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.8.10/index.min.css" />\n  <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css">\n  <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="<%= assets.style %>"><% } %>\n  <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.<%= assets.version %>.css"><% } %>\n</head>\n<body>\n  <div id="app"></div>\n  <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n  <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n  <% if (assets.vendors) { %><script type="text/javascript" src="<%= assets.vendors %>"><\/script><% } %>\n  <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"><\/script><% } %>\n  <% if (assets.version) { %>\n  <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.vendors.<%= assets.version %>.js"><\/script>\n  <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-authz/assets/auth0-authz.ui.<%= assets.version %>.js"><\/script>\n  <% } %>\n</body>\n</html>'},function(e,t,r){const n=r(2),s=(e,t,r)=>{e.route({method:"GET",path:"/admins/login",config:{auth:!1},handler:(e,t)=>t("Redirecting to login page...").redirect(`${n("PUBLIC_WT_URL")}/login`)}),r()};s.attributes={name:"routes"},e.exports=s},function(e,t,r){const n=r(26),s=r(4);function o(e){return this.response(n.notFound(e))}function i(e){s.error(e);const t=e.message&&e.message.error||e.message||e.code||e.name||e.text||e.description||e;return e.message&&429===e.message.statusCode?this.response(n.tooManyRequests(t)):this.response(n.badRequest(t))}function a(e){return this.response(n.unauthorized(e))}const u=(e,t,r)=>{e.decorate("reply","notFound",o),e.decorate("reply","error",i),e.decorate("reply","unauthorized",a),r()};u.attributes={name:"reply-decorators"},e.exports=u},function(e,t,r){const{getDb:n}=r(11),s=(e,t,r)=>{const s=n();e.decorate("server","storage",s),e.decorate("request","storage",s),r()};s.attributes={name:"storage"},e.exports=s}]);